<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOISS Produktkatalog</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --color-primary: #ef8006;
            --color-primary-dark: #cc6f05;
            --color-primary-light: #ff9a33;
            --color-accent: #ffb347;
            --color-text-dark: #1a1a1a;
            --color-text-medium: #4a4a4a;
            --color-text-light: #6b6b6b;
            --color-bg-white: #ffffff;
            --color-bg-light: #f5f5f5;
            --color-border: #e0e0e0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text-dark);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-dark) 100%);
            color: white;
            padding: 1.5rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header p {
            margin-top: 0.5rem;
            opacity: 0.95;
            font-size: 0.95rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .filters {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 2rem;
        }

        .search-box {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.3s;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .filter-row label {
            font-weight: 500;
            color: var(--color-text-medium);
            min-width: 80px;
        }

        .filter-row select {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .filter-row select:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .product-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--color-bg-light);
        }

        .product-info {
            padding: 1.25rem;
        }

        .product-category {
            color: var(--color-primary);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .product-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text-dark);
            margin-bottom: 0.5rem;
            min-height: 2.4em;
        }

        .product-variants {
            color: var(--color-text-light);
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }

        .product-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 1rem;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            overflow-y: auto;
        }

        .modal.active {
            display: block;
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 0;
            width: 90%;
            max-width: 900px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: var(--color-text-dark);
            font-size: 1.5rem;
        }

        .close {
            color: var(--color-text-light);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
            line-height: 1;
        }

        .close:hover {
            color: var(--color-primary);
        }

        .modal-body {
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .modal-image {
            width: 100%;
            border-radius: 8px;
            background: var(--color-bg-light);
        }

        .modal-details {
            display: flex;
            flex-direction: column;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section label {
            display: block;
            font-weight: 600;
            color: var(--color-text-medium);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .color-select, .size-table {
            width: 100%;
        }

        .color-select {
            padding: 0.75rem;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
        }

        .size-table {
            border-collapse: collapse;
            width: 100%;
        }

        .size-table th,
        .size-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }

        .size-table th {
            background: var(--color-bg-light);
            font-weight: 600;
            color: var(--color-text-medium);
            font-size: 0.9rem;
        }

        .size-table input[type="number"] {
            width: 80px;
            padding: 0.5rem;
            border: 2px solid var(--color-border);
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .size-table input[type="number"]:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-dark);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: var(--color-border);
            cursor: not-allowed;
            transform: none;
        }

        /* Anfragekorb */
        .cart-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(239, 128, 6, 0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 999;
        }

        .cart-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(239, 128, 6, 0.6);
        }

        .cart-badge {
            background: white;
            color: var(--color-primary);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .cart-sidebar {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s;
            z-index: 1001;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.active {
            right: 0;
        }

        .cart-header {
            padding: 1.5rem;
            background: var(--color-primary);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            font-size: 1.3rem;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .cart-item {
            background: var(--color-bg-light);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
        }

        .cart-item-header {
            font-weight: 600;
            color: var(--color-text-dark);
            margin-bottom: 0.5rem;
        }

        .cart-item-details {
            font-size: 0.9rem;
            color: var(--color-text-medium);
            margin-bottom: 0.25rem;
        }

        .cart-item-remove {
            color: #dc3545;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .cart-item-remove:hover {
            text-decoration: underline;
        }

        .cart-footer {
            padding: 1.5rem;
            border-top: 2px solid var(--color-border);
        }

        .empty-cart {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--color-text-light);
        }

        /* Loading/Error States */
        .loading, .error {
            padding: 3rem;
            text-align: center;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .loading {
            color: var(--color-text-medium);
        }

        .error {
            color: #dc3545;
            background: #fff5f5;
            border: 2px solid #ffebee;
        }

        @media (max-width: 768px) {
            .modal-body {
                grid-template-columns: 1fr;
            }

            .cart-sidebar {
                width: 100%;
                right: -100%;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõçÔ∏è HOISS Produktkatalog</h1>
        <p>W√§hlen Sie Ihre Produkte und starten Sie eine Anfrage</p>
    </div>

    <div class="container">
        <div class="filters">
            <input type="text" class="search-box" id="searchInput" placeholder="Produkte durchsuchen...">
            <div class="filter-row">
                <label>Hersteller:</label>
                <select id="manufacturerFilter">
                    <option value="">Alle Hersteller</option>
                </select>
            </div>
        </div>

        <div id="productContainer">
            <div class="loading">
                <p>‚è≥ Lade Produkte...</p>
            </div>
        </div>
    </div>

    <!-- Produktdetail Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalProductName"></h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div>
                    <img id="modalProductImage" class="modal-image" src="" alt="Produktbild">
                </div>
                <div class="modal-details">
                    <div class="detail-section">
                        <label>Farbe w√§hlen:</label>
                        <select id="colorSelect" class="color-select"></select>
                    </div>
                    <div class="detail-section">
                        <label>Gr√∂√üe & Menge:</label>
                        <table class="size-table">
                            <thead>
                                <tr>
                                    <th>Gr√∂√üe</th>
                                    <th>UVP</th>
                                    <th>Menge</th>
                                </tr>
                            </thead>
                            <tbody id="sizeTableBody">
                            </tbody>
                        </table>
                    </div>
                    <button class="btn btn-primary" id="addToCartBtn">Zum Anfragekorb hinzuf√ºgen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Anfragekorb Sidebar -->
    <div id="cartSidebar" class="cart-sidebar">
        <div class="cart-header">
            <h2>Anfragekorb</h2>
            <span class="close" id="closeCart">&times;</span>
        </div>
        <div class="cart-items" id="cartItems"></div>
        <div class="cart-footer">
            <button class="btn btn-primary" style="width: 100%;" id="submitInquiryBtn">Anfrage absenden</button>
        </div>
    </div>

    <!-- Floating Cart Button -->
    <button class="cart-button" id="cartButton">
        üõí Anfragekorb
        <span class="cart-badge" id="cartBadge">0</span>
    </button>

    <script>
        let allProducts = [];
        let cart = [];
        let currentProduct = null;

        // Excel laden
        async function loadExcelFile() {
            try {
                console.log('Starte Excel-Laden...');
                const response = await fetch('Article_Export_2025-09_(EUR).xlsx');
                const arrayBuffer = await response.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer, { type: 'array' });

                console.log('Excel-Datei geladen, lese Daten...');
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(firstSheet);

                console.log(`${data.length} Zeilen gefunden`);
                console.log('Verarbeite Produkte...');

                processProducts(data);
            } catch (error) {
                console.error('Fehler beim Laden:', error);
                document.getElementById('productContainer').innerHTML = `
                    <div class="error">
                        <h3>‚ùå Fehler beim Laden der Excel-Datei</h3>
                        <p>${error.message}</p>
                        <p>Bitte stellen Sie sicher, dass die Datei "Article_Export_2025-09_(EUR).xlsx" im gleichen Verzeichnis liegt.</p>
                    </div>
                `;
            }
        }

        // Produkte verarbeiten und gruppieren
        function processProducts(data) {
            const grouped = {};

            data.forEach(row => {
                const style = row.Style || 'unknown';
                const sku = row.SKU || '';
                const manufacturer = row.Manufacturer || 'Unbekannt';
                const name = row.Name || 'Unbekannt';
                const colour = row.Colour || 'Standard';
                const size = row.Size || 'Einheitsgr√∂√üe';
                const uvp = parseFloat(row.UVP) || 0;
                const packshot = row.Packshot || '';
                const ean = row.EAN || '';

                if (!grouped[style]) {
                    grouped[style] = {
                        style: style,
                        manufacturer: manufacturer,
                        name: name,
                        packshot: packshot,
                        variants: [],
                        colors: new Set(),
                        sizes: new Set()
                    };
                }

                grouped[style].variants.push({
                    sku: sku,
                    color: colour,
                    size: size,
                    uvp: uvp,
                    ean: ean,
                    packshot: packshot
                });

                grouped[style].colors.add(colour);
                grouped[style].sizes.add(size);
            });

            // In Array umwandeln
            allProducts = Object.values(grouped).map(product => ({
                ...product,
                colors: Array.from(product.colors),
                sizes: Array.from(product.sizes),
                minPrice: Math.min(...product.variants.map(v => v.uvp)),
                maxPrice: Math.max(...product.variants.map(v => v.uvp))
            }));

            console.log(`${allProducts.length} Produktgruppen erstellt`);
            console.log(`${allProducts.reduce((sum, p) => sum + p.variants.length, 0)} Varianten insgesamt`);

            populateFilters();
            displayProducts(allProducts);
        }

        // Filter bef√ºllen
        function populateFilters() {
            const manufacturers = [...new Set(allProducts.map(p => p.manufacturer))].sort();
            const manufacturerFilter = document.getElementById('manufacturerFilter');

            manufacturers.forEach(manufacturer => {
                const option = document.createElement('option');
                option.value = manufacturer;
                option.textContent = manufacturer;
                manufacturerFilter.appendChild(option);
            });
        }

        // Produkte anzeigen
        function displayProducts(products) {
            const container = document.getElementById('productContainer');

            if (products.length === 0) {
                container.innerHTML = '<div class="loading"><p>Keine Produkte gefunden</p></div>';
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'products-grid';

            products.forEach(product => {
                const card = createProductCard(product);
                grid.appendChild(card);
            });

            container.innerHTML = '';
            container.appendChild(grid);
        }

        // Produktkarte erstellen
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';

            const imageUrl = product.packshot ? `img-products/${product.packshot}` : 'https://via.placeholder.com/300x200?text=Kein+Bild';

            const priceText = product.minPrice === product.maxPrice 
                ? `${product.minPrice.toFixed(2)} ‚Ç¨`
                : `ab ${product.minPrice.toFixed(2)} ‚Ç¨`;

            card.innerHTML = `
                <img src="${imageUrl}" alt="${product.name}" class="product-image" onerror="this.src='https://via.placeholder.com/300x200?text=Kein+Bild'">
                <div class="product-info">
                    <div class="product-category">${product.manufacturer}</div>
                    <div class="product-name">${product.name}</div>
                    <div class="product-variants">${product.colors.length} Farbe(n) ‚Ä¢ ${product.sizes.length} Gr√∂√üe(n)</div>
                    <div class="product-price">${priceText}</div>
                </div>
            `;

            card.addEventListener('click', () => openProductModal(product));

            return card;
        }

        // Produktdetails √∂ffnen
        function openProductModal(product) {
            currentProduct = product;
            document.getElementById('modalProductName').textContent = `${product.manufacturer} - ${product.name}`;
            document.getElementById('modalProductImage').src = product.packshot 
                ? `img-products/${product.packshot}` 
                : 'https://via.placeholder.com/400x400?text=Kein+Bild';

            // Farbauswahl
            const colorSelect = document.getElementById('colorSelect');
            colorSelect.innerHTML = '';
            product.colors.forEach(color => {
                const option = document.createElement('option');
                option.value = color;
                option.textContent = color;
                colorSelect.appendChild(option);
            });

            updateSizeTable();
            document.getElementById('productModal').classList.add('active');

            colorSelect.addEventListener('change', updateSizeTable);
        }

        // Gr√∂√üentabelle aktualisieren
        function updateSizeTable() {
            const selectedColor = document.getElementById('colorSelect').value;
            const sizeTableBody = document.getElementById('sizeTableBody');

            // Filtere Varianten nach ausgew√§hlter Farbe
            const colorVariants = currentProduct.variants.filter(v => v.color === selectedColor);

            sizeTableBody.innerHTML = '';
            colorVariants.forEach(variant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${variant.size}</td>
                    <td>${variant.uvp.toFixed(2)} ‚Ç¨</td>
                    <td><input type="number" min="0" value="0" data-sku="${variant.sku}" data-size="${variant.size}" data-uvp="${variant.uvp}"></td>
                `;
                sizeTableBody.appendChild(row);
            });
        }

        // Zum Warenkorb hinzuf√ºgen
        document.getElementById('addToCartBtn').addEventListener('click', () => {
            const selectedColor = document.getElementById('colorSelect').value;
            const inputs = document.querySelectorAll('#sizeTableBody input[type="number"]');

            let addedItems = 0;
            inputs.forEach(input => {
                const quantity = parseInt(input.value) || 0;
                if (quantity > 0) {
                    cart.push({
                        manufacturer: currentProduct.manufacturer,
                        name: currentProduct.name,
                        color: selectedColor,
                        size: input.dataset.size,
                        sku: input.dataset.sku,
                        uvp: parseFloat(input.dataset.uvp),
                        quantity: quantity
                    });
                    addedItems++;
                }
            });

            if (addedItems > 0) {
                updateCart();
                document.getElementById('productModal').classList.remove('active');
                alert(`${addedItems} Artikel zum Anfragekorb hinzugef√ºgt!`);
            } else {
                alert('Bitte w√§hlen Sie mindestens eine Gr√∂√üe mit Menge > 0 aus.');
            }
        });

        // Warenkorb aktualisieren
        function updateCart() {
            document.getElementById('cartBadge').textContent = cart.length;

            const cartItems = document.getElementById('cartItems');
            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="empty-cart">Ihr Anfragekorb ist leer</div>';
                return;
            }

            cartItems.innerHTML = '';
            cart.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'cart-item';
                itemDiv.innerHTML = `
                    <div class="cart-item-header">${item.manufacturer} - ${item.name}</div>
                    <div class="cart-item-details">Farbe: ${item.color} | Gr√∂√üe: ${item.size}</div>
                    <div class="cart-item-details">Menge: ${item.quantity} | UVP: ${item.uvp.toFixed(2)} ‚Ç¨</div>
                    <div class="cart-item-details">SKU: ${item.sku}</div>
                    <div class="cart-item-remove" data-index="${index}">Entfernen</div>
                `;
                cartItems.appendChild(itemDiv);
            });

            // Event Listener f√ºr Entfernen
            document.querySelectorAll('.cart-item-remove').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    cart.splice(index, 1);
                    updateCart();
                });
            });
        }

        // Anfrage absenden
        document.getElementById('submitInquiryBtn').addEventListener('click', () => {
            if (cart.length === 0) {
                alert('Ihr Anfragekorb ist leer!');
                return;
            }

            const name = prompt('Ihr Name:');
            const email = prompt('Ihre E-Mail:');
            const phone = prompt('Ihre Telefonnummer (optional):');
            const message = prompt('Nachricht / Anmerkungen (optional):');

            if (!name || !email) {
                alert('Bitte geben Sie mindestens Ihren Namen und Ihre E-Mail-Adresse an.');
                return;
            }

            // Hier w√ºrde normalerweise die Anfrage an den Server gesendet
            console.log('Anfrage:', {
                customer: { name, email, phone, message },
                items: cart
            });

            alert(`Vielen Dank, ${name}! Ihre Anfrage wurde erfolgreich √ºbermittelt. Wir melden uns in K√ºrze bei Ihnen.`);
            cart = [];
            updateCart();
            document.getElementById('cartSidebar').classList.remove('active');
        });

        // Event Listeners
        document.getElementById('cartButton').addEventListener('click', () => {
            document.getElementById('cartSidebar').classList.add('active');
        });

        document.getElementById('closeCart').addEventListener('click', () => {
            document.getElementById('cartSidebar').classList.remove('active');
        });

        document.querySelectorAll('.close').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.target.closest('.modal').classList.remove('active');
            });
        });

        // Filter Events
        document.getElementById('searchInput').addEventListener('input', filterProducts);
        document.getElementById('manufacturerFilter').addEventListener('change', filterProducts);

        function filterProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const manufacturer = document.getElementById('manufacturerFilter').value;

            const filtered = allProducts.filter(product => {
                const matchesSearch = product.name.toLowerCase().includes(searchTerm) || 
                                     product.manufacturer.toLowerCase().includes(searchTerm);
                const matchesManufacturer = !manufacturer || product.manufacturer === manufacturer;

                return matchesSearch && matchesManufacturer;
            });

            displayProducts(filtered);
        }

        // Beim Laden
        loadExcelFile();
        updateCart();
    </script>
</body>
</html>